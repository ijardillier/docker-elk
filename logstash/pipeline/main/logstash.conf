input {
  tcp {
    port => 5000
  }
}

filter {
  if [@metadata][input][tcp][source] and ![host] {
    mutate {
      copy => {
        "[@metadata][input][tcp][source][name]" => "[host][name]"
        "[@metadata][input][tcp][source][ip]"   => "[host][ip]"
      }
    }
  }
}

# filter {
#       if [@metadata][beat] == "filebeat" {
#         mutate { add_field => { "[@metadata][target_index]" => "logs-%{[@metadata][beat]}-%{[@metadata][version]}" } }
#       } [@metadata][beat] == "metricbeat" {
#         mutate { add_field => { "[@metadata][target_index]" => "metrics-%{[@metadata][beat]}-%{[@metadata][version]}" } }
#       } else {
#         mutate { add_field => { "[@metadata][target_index]" => "logstash" } }
#       }
#     }

# output {
#   stdout {
#     codec => rubydebug { metadata => true }
#   }
# }

output {
	elasticsearch {
		#index => "%{[@metadata][beat]}-%{[@metadata][version]}"
		hosts => ["https://es01:9200","https://es02:9200","https://es03:9200"]
		cacert => ["/usr/share/logstash/certs/ca/ca.crt"]
    	#data_stream => false
		user => "elastic"
		password => "changeme"
	}
}
